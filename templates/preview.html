<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ filename }}</title>
    
    <!-- TailwindCSS with Typography Plugin -->
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    
    <!-- Print-optimized CSS -->
    <style>
        /* Print-specific styles */
        @media print {
            @page {
                size: A4 portrait;
                margin: 20mm 20mm 20mm 20mm;
            }
            
            /* Hide print button and controls when printing */
            .no-print {
                display: none !important;
            }
            
            /* Ensure colors are preserved */
            * {
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            
            /* Break handling */
            h1, h2, h3, h4, h5, h6 {
                break-after: avoid;
                page-break-after: avoid;
            }
            
            /* Prevent breaking inside elements */
            pre, blockquote, table {
                break-inside: avoid;
                page-break-inside: avoid;
            }
            
            /* Link handling for print */
            a[href]:after {
                content: "";
            }
            
            /* Internal links (anchors) should not show URLs */
            a[href^="#"]:after {
                content: "";
            }
            
            /* Table styles for print */
            table {
                border-collapse: collapse;
                width: 100%;
            }
            
            /* Code block improvements */
            pre {
                white-space: pre-wrap;
                word-break: break-all;
            }
        }
        
        /* Screen-only styles */
        @media screen {
            body {
                background-color: #f5f5f5;
                padding: 2rem;
            }
            
            .page-container {
                max-width: 210mm;
                min-height: 297mm;
                margin: 0 auto;
                background: white;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                padding: 20mm;
            }
            
            .print-controls {
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 1000;
                background: white;
                padding: 1rem;
                border-radius: 8px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            }
        }

        /* Syntax highlighting styles - dynamically generated from selected Pygments theme */
        {{ codehilite_css | safe }}
    </style>
</head>
<body>
    <!-- Print Controls (hidden when printing) -->
    <div class="print-controls no-print">
        <h3 class="text-lg font-semibold mb-3">{{ filename }}</h3>
        <button onclick="window.print()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors mb-2 w-full">
            üñ®Ô∏è Print/Save as PDF
        </button>
        <button onclick="window.history.back()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors w-full">
            ‚Üê Back to Upload
        </button>
        <div class="text-sm text-gray-600 mt-3">
            <p><strong>üí° How to save:</strong> Click "Print/Save as PDF", select "Save as PDF" as destination</p>
            <p><strong>üìÅ Filename:</strong> Will be pre-filled as "{{ filename }}.pdf"</p>
        </div>
    </div>

    <!-- Page Container (A4 size on screen, full width when printing) -->
    <div class="page-container">
        <article class="prose {% if config.prose_color %}{{ config.prose_color if config.prose_color.startswith('prose-') else 'prose-' + config.prose_color }}{% endif %} {{ config.prose_size if (config.prose_size and (config.prose_size == 'prose' or config.prose_size.startswith('prose-'))) else ('prose-' + (config.prose_size or 'lg')) }} max-w-none">
            {{ html_content | safe }}
        </article>
    </div>

    <script>
        // Set up print filename handling
        const originalTitle = document.title;
        const pdfFilename = "{{ filename }}";

        window.addEventListener('beforeprint', function() {
            document.title = pdfFilename;
        });

        window.addEventListener('afterprint', function() {
            document.title = originalTitle;
        });

        // Add keyboard shortcut for printing
        document.addEventListener('keydown', function(e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
                e.preventDefault();
                window.print();
            }
        });

        // Enhance table of contents links
        document.addEventListener('DOMContentLoaded', function() {
            // Find all anchor links
            const links = document.querySelectorAll('a[href^="#"]');
            links.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href').substring(1);
                    const targetElement = document.getElementById(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });
        });
    </script>
</body>
</html>